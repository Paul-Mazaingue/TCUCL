<!-- comparison.component.html -->
<div class="comparison-container">
  <!-- Header with Mode Selection -->
  <div class="header-section">
    <div class="header-content">
      <h1>Tableau de Bord de Comparaison</h1>
      <p>Analysez et comparez les diff√©rents sc√©narios d'√©missions</p>
    </div>
    <div class="mode-selection">
      <button 
        [class.active]="comparisonMode === 'scenarios'" 
        (click)="setComparisonMode('scenarios')"
        class="mode-btn scenario-mode">
        <i class="icon">üìä</i>
        Comparer les Sc√©narios
      </button>
      <button 
        [class.active]="comparisonMode === 'posts'" 
        (click)="setComparisonMode('posts')"
        class="mode-btn post-mode">
        <i class="icon">üìà</i>
        Comparer par Postes
      </button>
    </div>
  </div>

  <!-- SCENARIOS COMPARISON VIEW -->
  <div *ngIf="comparisonMode === 'scenarios'" class="scenarios-view">
    
    <!-- Global Emissions Summary -->
    <div class="global-emissions-card">
      <h2>√âmissions Globales - Vue d'Ensemble</h2>
      <div class="emissions-grid">
        <div class="emission-item baseline">
          <span class="label">Sc√©nario de r√©f√©rence</span>
          <span class="value">{{ globalEmissions.baseline | number:'1.0-0' }} tCO‚ÇÇe</span>
        </div>
        <div class="emission-item target">
          <span class="label">Cible de r√©duction</span>
          <span class="value">{{ globalEmissions.target | number:'1.0-0' }} tCO‚ÇÇe</span>
        </div>
        <div class="emission-item current" *ngIf="bestScenario">
          <span class="label">Meilleur sc√©nario s√©lectionn√©</span>
          <span class="value">{{ bestScenario.totalEmissions | number:'1.0-0' }} tCO‚ÇÇe</span>
          <span class="reduction" [class.positive]="bestScenario.reductionPercentage < 0">
            ({{ bestScenario.reductionPercentage.toFixed(1) }}% de r√©duction)
          </span>
        </div>
      </div>
    </div>

    <!-- Scenario Selection -->
    <div class="selection-section">
      <div class="section-header">
        <h2>S√©lection des Sc√©narios √† Comparer</h2>
        <div class="selection-actions">
          <button (click)="selectAllScenarios()" class="btn btn-outline">
            Tout s√©lectionner
          </button>
          <button (click)="clearAllSelections()" class="btn btn-outline">
            Tout d√©s√©lectionner
          </button>
        </div>
      </div>
      
      <div class="scenario-cards">
        <div 
          *ngFor="let scenario of scenarios" 
          class="scenario-card" 
          [class.selected]="selectedScenarioIds.includes(scenario.id)"
          (click)="toggleScenario(scenario.id)"
        >
          <div class="card-header">
            <h3>{{ scenario.name }}</h3>
            <div class="selection-indicator">
              {{ selectedScenarioIds.includes(scenario.id) ? '‚úì' : '' }}
            </div>
          </div>
          <p class="description">{{ scenario.description }}</p>
          <div class="scenario-info">
            <div class="info-item">
              <span class="label">√âmissions totales:</span>
              <span class="value">{{ scenario.totalEmission }}</span>
            </div>
            <div class="info-item">
              <span class="label">R√©duction estim√©e:</span>
              <span class="reduction" [class.positive]="scenario.reductionEstimee.startsWith('-')">
                {{ scenario.reductionEstimee }}
              </span>
            </div>
            <div class="info-item">
              <span class="label">√âcart cible:</span>
              <span class="ecart">{{ scenario.ecartCible }} tCO‚ÇÇe</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section" *ngIf="selectedScenarioIds.length > 0">
      <h2>Comparaison Visuelle des Sc√©narios</h2>
      
      <div class="charts-grid">
        <!-- Total Emissions Bar Chart -->
        <div class="chart-card">
          <h3>√âmissions Totales par Sc√©nario</h3>
          <div class="chart-container">
            <canvas 
              baseChart
              [data]="scenarioBarChartData"
              [options]="scenarioBarChartOptions"
              type="bar">
            </canvas>
          </div>
        </div>

        <!-- Radar Chart for Detailed Comparison -->
        <div class="chart-card">
          <h3>Analyse D√©taill√©e par Poste (Radar)</h3>
          <div class="chart-container">
            <canvas 
              baseChart
              [data]="radarChartData"
              type="radar">
            </canvas>
          </div>
        </div>

        <!-- Detailed Comparison Table -->
        <div class="table-card full-width">
          <h3>Comparaison D√©taill√©e des Postes d'√âmission</h3>
          <div class="table-container">
            <table class="comparison-table">
              <thead>
                <tr>
                  <th>Poste d'√âmission</th>
                  <th *ngFor="let scenario of calculatedScenarios" [style.color]="getScenarioColor(scenario.id, 1)">
                    {{ scenario.name }}
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let postName of getPostNames()">
                  <td class="post-name">{{ postName }}</td>
                  <td *ngFor="let scenario of calculatedScenarios">
                    {{ getPostEmission(scenario, postName) | number:'1.0-0' }} tCO‚ÇÇe
                  </td>
                </tr>
                <tr class="total-row">
                  <td><strong>Total</strong></td>
                  <td *ngFor="let scenario of calculatedScenarios">
                    <strong>{{ scenario.totalEmissions | number:'1.0-0' }} tCO‚ÇÇe</strong>
                  </td>
                </tr>
                <tr class="reduction-row">
                  <td><strong>R√©duction vs R√©f√©rence</strong></td>
                  <td *ngFor="let scenario of calculatedScenarios">
                    <strong [class.positive]="scenario.reductionPercentage < 0">
                      {{ scenario.reductionPercentage.toFixed(1) }}%
                    </strong>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="selectedScenarioIds.length === 0">
      <div class="empty-content">
        <i class="icon">üîç</i>
        <h3>Aucun sc√©nario s√©lectionn√©</h3>
        <p>S√©lectionnez au moins deux sc√©narios pour commencer la comparaison</p>
      </div>
    </div>
  </div>

  <!-- POSTS COMPARISON VIEW -->
  <div *ngIf="comparisonMode === 'posts'" class="posts-view">
    
    <!-- Year Selection and Global Summary -->
    <div class="posts-header">
      <div class="year-selection">
        <h2>Comparaison Temporelle des Postes</h2>
        <div class="year-inputs">
          <div class="year-input">
            <label>Ann√©e de d√©part:</label>
            <select [(ngModel)]="year1" (change)="updateCharts()">
              <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
            </select>
          </div>
          <div class="year-input">
            <label>Ann√©e cible:</label>
            <select [(ngModel)]="year2" (change)="updateCharts()">
              <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
            </select>
          </div>
        </div>
      </div>

      <div class="global-summary">
        <div class="summary-item">
          <span class="label">Total {{ year1 }}:</span>
          <span class="value">{{ totalYear1 | number:'1.0-0' }} tCO‚ÇÇe</span>
        </div>
        <div class="summary-item">
          <span class="label">Total {{ year2 }}:</span>
          <span class="value">{{ totalYear2 | number:'1.0-0' }} tCO‚ÇÇe</span>
        </div>
        <div class="summary-item">
          <span class="label">R√©duction totale:</span>
          <span class="reduction" [class.positive]="totalReduction.startsWith('-')">
            {{ totalReduction }}%
          </span>
        </div>
      </div>
    </div>

    <!-- Posts Selection -->
    <div class="posts-selection">
      <h3>S√©lection des Postes √† Comparer</h3>
      <div class="posts-checkboxes">
        <label *ngFor="let post of emissionPosts" class="checkbox-label">
          <input 
            type="checkbox" 
            [(ngModel)]="post.selected" 
            (change)="updateCharts()">
          <span class="checkmark"></span>
          {{ post.name }}
        </label>
      </div>
    </div>

    <!-- Posts Comparison Charts -->
    <div class="posts-charts" *ngIf="selectedPosts.length > 0">
      <div class="charts-grid">
        <!-- Main Comparison Chart -->
        <div class="chart-card">
          <h3>Comparaison {{ year1 }} vs {{ year2 }}</h3>
          <div class="chart-container">
            <canvas 
              baseChart
              [data]="barChartData"
              [options]="barChartOptions"
              type="bar">
            </canvas>
          </div>
        </div>

        <!-- Trend Chart -->
        <div class="chart-card">
          <h3>√âvolution Temporelle des Postes</h3>
          <div class="chart-container">
            <canvas 
              baseChart
              [data]="postsComparisonChartData"
              type="line">
            </canvas>
          </div>
        </div>

        <!-- Detailed Table -->
        <div class="table-card full-width">
          <h3>D√©tail des R√©ductions par Poste</h3>
          <div class="table-container">
            <table class="posts-table">
              <thead>
                <tr>
                  <th>Poste d'√âmission</th>
                  <th>√âmissions {{ year1 }} (tCO‚ÇÇe)</th>
                  <th>√âmissions {{ year2 }} (tCO‚ÇÇe)</th>
                  <th>R√©duction</th>
                  <th>Pourcentage</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let post of calculatedPosts">
                  <td class="post-name">{{ post.name }}</td>
                  <td>{{ post.value1 | number:'1.0-0' }}</td>
                  <td>{{ post.value2 | number:'1.0-0' }}</td>
                  <td>{{ (post.value2 - post.value1) | number:'1.0-0' }}</td>
                  <td [class]="getReductionClass(post.reduction)">
                    {{ post.reduction }}%
                  </td>
                </tr>
                <tr class="total-row">
                  <td><strong>Total</strong></td>
                  <td><strong>{{ totalYear1 | number:'1.0-0' }}</strong></td>
                  <td><strong>{{ totalYear2 | number:'1.0-0' }}</strong></td>
                  <td><strong>{{ (totalYear2 - totalYear1) | number:'1.0-0' }}</strong></td>
                  <td [class]="getReductionClass(totalReduction)">
                    <strong>{{ totalReduction }}%</strong>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="navigation-footer">
    <button (click)="goToPilotageScenario()" class="btn btn-primary">
      ‚Üê Retour au Pilotage des Sc√©narios
    </button>
  </div>
</div>